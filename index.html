<!DOCTYPE html>

<html lang="en">
<head>
  <meta name="generator" content=
  "HTML Tidy for HTML5 (experimental) for Linux https://github.com/w3c/tidy-html5/tree/c63cc39">
  <meta http-equiv="Content-Type" content=
  "text/html; charset=utf-8">
  <meta charset="utf-8">

  <title>BlueButton+ Pull API</title>
  <meta name="viewport" content=
  "width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content=""><!-- Le styles -->
  <link href="assets/css/bootstrap.css" rel="stylesheet">
  <link href="assets/css/bootstrap-responsive.css" rel=
  "stylesheet">
  <link href="assets/css/docs.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/gh-fork-ribbon.css">
  <!--[if IE]>
        <link rel="stylesheet" href="assets/css/gh-fork-ribbon.ie.css" />
    <![endif]-->
  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body data-spy="scroll" data-target=".bs-docs-sidebar" data-twttr-rendered="true">
  <div class="github-fork-ribbon-wrapper right">
    <div class="github-fork-ribbon">
      <a href=
      "https://github.com/jmandel/blue-button-plus-pull">Fork me on
      GitHub</a>
    </div>
  </div><!-- Navbar
      ================================================== -->
  <!-- Subhead
      ================================================== -->

  <header class="jumbotron subhead" id="overview">
    <div class="container">
      <h1>BlueButton+ Pull API</h1>

      <p class="lead">OAuth2 API for RESTful access to patient
      data</p>
    </div>
  </header>

  <div class="container">
    <!-- Docs nav
        ================================================== -->

    <div class="row">
      <div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav" data-offset-top="200">
          <li>
            <a href="#registration"><i class=
            "icon-chevron-right"></i> App Registration</a>
          </li>

          <li class="sidenav-indent">
            <a href="#registration-open"><i class=
            "icon-chevron-right"></i> Open Registration</a>
          </li>

          <li class="sidenav-indent">
            <a href="#registration-trusted"><i class=
            "icon-chevron-right"></i> Trusted Registration</a>
          </li>

          <li>
            <a href="#authorization"><i class=
            "icon-chevron-right"></i> App Authorization</a>
          </li>

          <li class="sidenav-indent">
            <a href="#authorization-code"><i class=
            "icon-chevron-right"></i> Authorization Code Grant</a>
          </li>

          <li class="sidenav-indent">
            <a href="#authorization-implicit"><i class=
            "icon-chevron-right"></i> Implicit Grant</a>
          </li>

          <li>
            <a href="#api"><i class="icon-chevron-right"></i>
            Clinical Data API (TODO)</a>
          </li>

          <li class="sidenav-indent">
            <a href="#api-summary"><i class=
            "icon-chevron-right"></i> Clinical Summary</a>
          </li>

          <li class="sidenav-indent">
            <a href="#api-search"><i class=
            "icon-chevron-right"></i> Document Search</a>
          </li>

          <li>
            <a href="#discovery"><i class="icon-chevron-right"></i>
            Endpoint Discovery</a>
          </li>

          <li class="sidenav-indent">
            <a href="#discovery-providers"><i class=
            "icon-chevron-right"></i> BB+ Providers</a>
          </li>

          <li class="sidenav-indent">
            <a href="#discovery-apps"><i class=
            "icon-chevron-right"></i> BB+ Apps</a>
          </li>
        </ul>
      </div>

      <div class="span9">
        <section id="registration">
          <div class="page-header">
            <h1>App Registration <small>an up-front, automated
            step</small></h1>

            <p>Before an app connects to a BlueButton+ providers,
            it registers with that provider as an OAuth2 client.
            The registration process informs the provider what the
            app is called, where to find it, what permissions it
            might ask patients for, and how to display an
            authorization screen to patients.</p>

            <p>BB+ apps register with providers using <a href=
            "http://tools.ietf.org/html/draft-ietf-oauth-dyn-reg-08">
            OAuth2 Dynamic Client Registration</a>. This guide
            walks through the process of registering a client using
            open registration, as well as an example of using
            trusted registration.</p>

            <h2 id="registration-open">Open
            Registration</h2>BlueButton+ providers offer an open
            registration option. To register, an app issues an
            <code>https POST</code> to the registration endpoint,
            supplying registration parameters as a JSON object.

            <div class="well alert-info">
              <strong>Note</strong>: Open registration is
              appropriate for new and experimental apps, but
              patient-facing authorization screens should display a
              warning indicating that an app's identity has not
              been verified. To provive a higher level of
              assurance, apps can perform a Trusted Registration
              (described below).
            </div>

            <h3 id="registration-parameters">Registration
            Parameters</h3>

            <table class="table table-striped">
              <tr>
                <th>Parameter</th>

                <th>Type</th>

                <th>Description</th>
              </tr>

              <tr>
                <td><code>client_name</code></td>

                <td><code>string</code></td>

                <td>Human-readable name of the Client to be
                presented to the user.</td>
              </tr>

              <tr>
                <td><code>client_uri</code></td>

                <td><code>string</code></td>

                <td>URL of the homepage of the Client.</td>
              </tr>

              <tr>
                <td><code>logo_uri</code></td>

                <td><code>string</code></td>

                <td>URL that references a logo for the Client. If
                present, the server SHOULD display this image to
                the end user during approval</td>
              </tr>

              <tr>
                <td><code>tos_uri</code></td>

                <td><code>string</code></td>

                <td>URL that points to a human-readable Terms of
                Service for the Client. The Authorization Server
                SHOULD display this URL to the End-User if it is
                given.</td>
              </tr>

              <tr>
                <td><code>redirect_uris</code></td>

                <td><code>array</code></td>

                <td>Array of redirect URIs for use in the
                Authorization Code and Implicit grant types. An
                Authorization Server SHOULD require registration of
                valid redirect URIs for all clients that use these
                grant types in order to protect against token and
                credential theft attacks.</td>
              </tr>

              <tr>
                <td><code>response_types</code></td>

                <td><code>array</code></td>

                <td>
                  Array of the OAuth 2.0 response types that the
                  Client may use.

                  <ul>
                    <li>public clients: <code>"token"</code> or
                    <code>"code"</code></li>

                    <li>confidential clients:
                    <code>"code"</code></li>
                  </ul>
                </td>
              </tr>

              <tr>
                <td><code>token_endpoint_auth_method</code></td>

                <td><code>string</code></td>

                <td>
                  The requested authentication type for the Token
                  Endpoint.

                  <ul>
                    <li>public clients: <code>"none"</code></li>

                    <li>confidential clients:
                    <code>"client_secret_basic"</code></li>
                  </ul>
                </td>
              </tr>

              <tr>
                <td><code>grant_types</code></td>

                <td><code>array</code></td>

                <td>
                  Array of OAuth 2.0 grant types that the Client
                  may use.

                  <ul>
                    <li>public clients:
                    <code>["implicit"]</code></li>

                    <li>confidential clients:
                    <code>["authorization_code"]</code></li>
                  </ul>
                </td>
              </tr>

              <tr>
                <td><code>scope</code></td>

                <td><code>string</code></td>

                <td>Space separated list of scope values (as
                described in OAuth 2.0 Section 3.3 [RFC6749]) that
                the client is declaring that it may use when
                requesting access tokens. A valid BB+ scope must
                include <code>single-patient</code>, and may
                additionally include
                <code>http://siframework.org/ABBI/endpoint/search</code>
                and
                <code>http://siframework.org/ABBI/endpoint/summary</code></td>
              </tr>

              <tr>
                <td><code>contacts</code></td>

                <td><code>array</code></td>

                <td>Array of email addresses for people responsible
                for this Client. The Authorization Server MAY make
                these addresses available to end users for support
                requests for the Client. An Authorization Server
                MAY use these email addresses as identifiers for an
                administrative page for this client.</td>
              </tr>
            </table>

            <h3>Example Registration for a Public Client</h3>
            <pre class="prettyprint">
POST /register HTTP/1.1
Content-Type: application/json
Accept: application/json
Host: bbplus-provider.org

{
  "client_name": "Blood Pressure Grapher",
  "client_uri": "https://bpgrapher.org",
  "logo_uri": "http://bpgrapher.org/images/logo.png",
  "contacts": [
    "plot-master@bpgrapher.org"
  ],
  "tos_uri": "https://bpgrapher.org/tos",
  "redirect_uris": [
    "https://bpgrapher.org/after-auth"
  ],
  "response_types": ["token"],
  "grant_types": ["implicit"],
  "token_endpoint_auth_method": "none",
  "scope":  "single-patient http://siframework.org/ABBI/endpoint/summary"
} 
</pre>

            <h3>Example Registration for a Confidential Client</h3>
            <pre class="prettyprint">
POST /register HTTP/1.1
Content-Type: application/json
Accept: application/json
Host: bbplus-provider.org

{
  "client_name": "Blood Pressure Grapher",
  "client_uri": "https://bpgrapher.org",
  "logo_uri": "http://bpgrapher.org/images/logo.png",
  "contacts": [
    "plot-master@bpgrapher.org"
  ],
  "tos_uri": "https://bpgrapher.org/tos",
  "redirect_uris": [
    "https://bpgrapher.org/after-auth"
  ],
  "response_types": ["code"],
  "grant_types": ["authorization_code"],
  "token_endpoint_auth_method": "client_secret_basic",
  "scope":  "single-patient http://siframework.org/ABBI/endpoint/summary"
} 
</pre>

            <h2 id="registration-trusted">Trusted Registration</h2>

            <p>In addition to open registration, BlueButton+
            providers support a Trusted Registration option. When
            performing a Trusted Registration, apps follow the
            protocol described above, with the addition of an
            <code>Authorization</code> header that includes a
            bearer token that the provider trusts (details below).
            This trusted bearer token is a <a href=
            "http://tools.ietf.org/html/draft-jones-json-web-signature">
            JSON Web Signature</a> with a header and body as
            defined below.</p>

            <div class="well alert-info">
              <strong>Note</strong>: This Trusted Registration
              protocol effectively allows an app to sign a
              registration request with its public key. The app is
              responsible for submitting a trusted certificate
              (along with a certificate chain, if necessary) to the
              BlueButton+ provider. The mechanism by which an app
              determines which certificates a BlueButton+ provider
              trusts is out of scope for this specification, but we
              expect that a central "trust bundle" will be made
              available via <a href=
              "https://secure.bluebuttontrust.org">secure.bluebuttontrust.org</a>
              to faciliate this process.
            </div>

            <h5>JWS Header</h5>

            <table class="table table-striped">
              <tr>
                <th>Assertion Key</th>

                <th>Constraints</th>

                <th>Comments</th>
              </tr>

              <tr>
                <td><code>alg</code><br></td>

                <td>Required. Fixed to <code>"RS256"</code></td>

                <td>Identifies the algorithm used to sign the
                Header and Body. ABBI uses RSA with SHA-256.</td>
              </tr>

              <tr>
                <td><code>typ</code></td>

                <td>Required. Fixed to <code>"JWS"</code></td>

                <td>Indicates that this is a JWS.</td>
              </tr>

              <tr>
                <td><code>x5u</code></td>

                <td>Required. An absolute URL to an X.509
                certificate chain in PEM encoded format starting
                with <code>https://</code></td>

                <td>The certificate that will be used to sign the
                JWT (and its trust chain).</td>
              </tr>
            </table>

            <h5>JWS Body</h5>

            <table class="table table-striped">
              <tr>
                <th>Assertion Key</th>

                <th>Type</th>

                <th>Comments</th>
              </tr>

              <tr>
                <td><code>iat</code></td>

                <td>Issue Time for this claim</td>

                <td>Required. Expressed as an IntDate (number of
                seconds since epoch).</td>
              </tr>

              <tr>
                <td><code>exp</code></td>

                <td>Expiration Time for this claim</td>

                <td>Required. Expressed as an IntDate (number of
                seconds since epoch). SHOULD be within ten minutes
                of <code>iat</code>.</td>
              </tr>

              <tr>
                <td><code>dynamic_registration_request</code></td>

                <td>Required. Must be a JSON object identical to
                the registration request POST body accompanying
                this <code>Authorization</code> header.</td>

                <td>Contains a copy of all registration parameters
                included in the POST body. This is designed to
                enforce a signature over the entire request.</td>
              </tr>
            </table>
          </div>TODO: Example JWS and update/revive <a href=
          "http://chb.github.com/abbi-dynreg-configuration/app/">chb.github.com/abbi-dynreg-configuration/app/</a>
        </section>

        <section id="authorization">
          <div class="page-header">
            <h1>App Authorization <small>a runtime, patient-driven
            step</small></h1>

            <p>BlueButton+ providers allow apps to obtain patient
            authorization to health data using standard OAuth2
            authorization flows. There are two authorization flows
            initially supported: Implcit Grant (appropriate only
            for public clients) and Authorization Code Grant
            (appropriate for public as well as confidential
            clients).</p>

            <p>Both flows follow the same basic pattern:</p>

            <ol>
              <li>App redirects the browser to a BlueButton+
              Provider's Authorization endpoint</li>

              <li>BB+ Provider authenticates patient and obtains
              authorization</li>

              <li>BB+ Provider redirects control back to App</li>
            </ol>

            <h2 id="authorization-code">Authorization Code Grant
            <small>for public or confidential clients</small></h2>

            <h3>1. App-to-Provider Redirection</h3>To initiate an
            Authorization Code Grant authorization, the app
            redirects the browser to a BlueButton+ provider's
            Authorization endpoint with the following URL
            parmeters:

            <table class="table table-striped">
              <tr>
                <th>Parameter</th>

                <th>Description</th>
              </tr>

              <tr>
                <td><code>response_type</code></td>

                <td>REQUIRED. Value MUST be set to
                <code>code</code>.</td>
              </tr>

              <tr>
                <td><code>client_id</code></td>

                <td>REQUIRED. The client identifier</td>
              </tr>

              <tr>
                <td><code>redirect_uri</code></td>

                <td>REQUIRED. Must match one of the client's
                pre-registered redirect URIs.</td>
              </tr>

              <tr>
                <td><code>scope</code></td>

                <td>REQUIRED. Must include
                <code>single-patient</code>, and may additionally
                include
                <code>http://siframework.org/ABBI/endpoint/search</code>
                and
                <code>http://siframework.org/ABBI/endpoint/summary</code></td>
              </tr>

              <tr>
                <td><code>state</code></td>

                <td>RECOMMENDED. An opaque value used by the client
                to maintain state between the request and callback.
                The authorization server includes this value when
                redirecting the user-agent back to the client. The
                parameter SHOULD be used for preventing cross-site
                request forgery</td>
              </tr>
            </table>

            <h5>Example App-to-Provider Redirection (newlines added
            for clarity)</h5>
            <pre class="prettyprint">
/authorize?
response_type=code&amp;
client_id=bp-grapher&amp;
redirect_uri=https%3A%2F%2Fbpgrapher.org%2Fafter-auth&amp;
scope=single-patient%20http%3A%2F%2Fsiframework.org%2FABBI%2Fendpoint%2Fsummary&amp;
state=98wrghuwuogerg97

Host: bbplus-provider.org
</pre>

            <h3>2. Provider Authenticates Patient and Obtains
            Authorization</h3>The mechanism by which providers
            authenticate patients and obtain authorization is out
            of scope for this specification

            <h3>3. Provider-to-App Redirection</h3>

            <p>After a successful authorization step, the
            BlueButton+ provider redirects the browser to the app's
            <code>redirect_uri</code>, with the following
            parameters <strong>supplied in the query
            component</strong>.</p>

            <table class="table table-striped">
              <tr>
                <th>Parameter</th>

                <th>Description</th>
              </tr>

              <tr>
                <td><code>code</code></td>

                <td>REQUIRED. The authorization code generated by
                the authorization server. The authorization code
                MUST expire shortly after it is issued to mitigate
                the risk of leaks.</td>
              </tr>

              <tr>
                <td><code>state</code></td>

                <td>REQUIRED. The exact value received from the
                client.</td>
              </tr>
            </table>

            <h5>Example Provider-to-App Redirection (newlines added
            for clarity)</h5>
            <pre class="prettyprint">
/after-oauth?
code=j0j9midoe0r9gjwro83h974t8gifb&amp;
state=98wrghuwuogerg97

Host: bpgrapher.org
</pre>

            <h3>4. App exchanges authorization code for access
            token</h3>

            <p>After receiving an authorization code, the app
            issues a request to the BlueButton+ provider's
            <code>Token URI</code> to exchange the authorization
            code for an access token. The exchange includes the
            following parameters</p>

            <table class="table table-striped">
              <tr>
                <th>Parameter</th>

                <th>Description</th>
              </tr>

              <tr>
                <td><code>grant_type</code></td>

                <td>REQUIRED. Fixed value:
                <code>authorization_code</code></td>
              </tr>

              <tr>
                <td><code>code</code></td>

                <td>REQUIRED. Code that an app can exchange for an
                access token.</td>
              </tr>

              <tr>
                <td><code>redirect_uri</code></td>

                <td>REQIRED. The same redirect_uri used in the
                initial authorization request</td>
              </tr>

              <tr>
                <td><code>client_id</code></td>

                <td>REQUIRED for public clients. May be omitted by
                confidential clients.</td>
              </tr>
            </table>

            <h5>Example Code-for-Token Exchange Request (Public
            Client)</h5>
            <pre class="prettyprint">
POST /token HTTP/1.1
Host: server.example.com
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&amp;
code=j0j9midoe0r9gjwro83h974t8gifb&amp;
redirect_uri=https%3A%2F%2Fbpgrapher.org%2Fafter-auth&amp;
client_id=bp-grapher 
</pre>

            <h5>Example Code-for-Token Exchange Request
            (Confidential Client)</h5>
            <pre class="prettyprint">
POST /token HTTP/1.1
Host: server.example.com
Authorization: Basic {{TODO: client password auth example}}
Content-Type: application/x-www-form-urlencoded/token?

grant_type=authorization_code&amp;
code=j0j9midoe0r9gjwro83h974t8gifb&amp;
redirect_uri=https%3A%2F%2Fbpgrapher.org%2Fafter-auth 
</pre>

            <p>The response is a JSON object containing the
            following parameters</p>

            <table class="table table-striped">
              <tr>
                <th>Parameter</th>

                <th>Description</th>
              </tr>

              <tr>
                <td><code>access_token</code></td>

                <td>REQUIRED. The access token issued by the
                authorization server</td>
              </tr>

              <tr>
                <td><code>token_type</code></td>

                <td>REQUIRED. Fixed value: <code>bearer</code></td>
              </tr>

              <tr>
                <td><code>expires_in</code></td>

                <td>REQUIRED. The lifetime in seconds of the access
                token. For example, the value "3600" denotes that
                the access token will expire in one hour from the
                time the response was generated.</td>
              </tr>

              <tr>
                <td><code>scope</code></td>

                <td>REQUIRED. Scope of access authorized by the
                patient.</td>
              </tr>
            </table>

            <h5>Example Code-for-Token Exchange Response</h5>
            <pre class="prettyprint">
{
  "access_token": "i8hweunweunweofiwweoijewiwe&amp;
  "token_type": "bearer:
  "expires_in": "3600"
  "scope": "single-patient http://siframework.org/ABBI/endpoint/summary"
} 
</pre>

            <h2 id="authorization-implicit">Implicit Grant
            <small>for public clients</small></h2>

            <h3>1. App-to-Provider Redirection</h3>To initiate an
            Implicit Grant authorization, the app redirects the
            browser to a BlueButton+ provider's Authorization
            endpoint with the following URL parmeters:

            <table class="table table-striped">
              <tr>
                <th>Parameter</th>

                <th>Description</th>
              </tr>

              <tr>
                <td><code>response_type</code></td>

                <td>REQUIRED. Value MUST be set to
                <code>token</code>.</td>
              </tr>

              <tr>
                <td><code>client_id</code></td>

                <td>REQUIRED. The client identifier</td>
              </tr>

              <tr>
                <td><code>redirect_uri</code></td>

                <td>REQUIRED. Must match one of the client's
                pre-registered redirect URIs.</td>
              </tr>

              <tr>
                <td><code>scope</code></td>

                <td>REQUIRED. Must include
                <code>single-patient</code>, and may additionally
                include
                <code>http://siframework.org/ABBI/endpoint/search</code>
                and
                <code>http://siframework.org/ABBI/endpoint/summary</code></td>
              </tr>

              <tr>
                <td><code>state</code></td>

                <td>RECOMMENDED. An opaque value used by the client
                to maintain state between the request and callback.
                The authorization server includes this value when
                redirecting the user-agent back to the client. The
                parameter SHOULD be used for preventing cross-site
                request forgery</td>
              </tr>
            </table>

            <h5>Example App-to-Provider Redirection (newlines added
            for clarity)</h5>
            <pre class="prettyprint">
/authorize?
response_type=token&amp;
client_id=bp-grapher&amp;
redirect_uri=https%3A%2F%2Fbpgrapher.org%2Fafter-auth&amp;
scope=single-patient%20http%3A%2F%2Fsiframework.org%2FABBI%2Fendpoint%2Fsummary&amp;
state=98wrghuwuogerg97

Host: bbplus-provider.org 
</pre>

            <h3>2. Provider Authenticates Patient and Obtains
            Authorization</h3>The mechanism by which providers
            authenticate patients and obtain authorization is out
            of scope for this specification

            <h3>3. Provider-to-App Redirection</h3>

            <p>After a successful authorization step, the
            BlueButton+ provider redirects the browser to the app's
            <code>redirect_uri</code>, with the following
            parameters <strong>embedded in the URI's #fragment
            component</strong>.</p>

            <table class="table table-striped">
              <tr>
                <th>Parameter</th>

                <th>Description</th>
              </tr>

              <tr>
                <td><code>access_token</code></td>

                <td>REQUIRED. The access token issued by the
                authorization server</td>
              </tr>

              <tr>
                <td><code>token_type</code></td>

                <td>REQUIRED. Fixed value: <code>bearer</code></td>
              </tr>

              <tr>
                <td><code>expires_in</code></td>

                <td>REQUIRED. The lifetime in seconds of the access
                token. For example, the value "3600" denotes that
                the access token will expire in one hour from the
                time the response was generated.</td>
              </tr>

              <tr>
                <td><code>scope</code></td>

                <td>REQUIRED. Scope of access authorized by the
                patient.</td>
              </tr>

              <tr>
                <td><code>state</code></td>

                <td>REQUIRED. The exact value received from the
                client.</td>
              </tr>
            </table>

            <h5>Example Provider-to-App Redirection (newlines added
            for clarity)</h5>
            <pre class="prettyprint">
/after-auth#
access_token=i8hweunweunweofiwweoijewiwe&amp;
token_type=bearer&amp;
expires_in=3600&amp;
scope=single-patient%20http%3A%2F%2Fsiframework.org%2FABBI%2Fendpoint%2Fsummary&amp;
state=98wrghuwuogerg97

Host: bbplus-provider.org 
</pre>
          </div>
        </section>

        <section id="discovery">
          <div class="page-header">
            <h1>Provider and App Discovery <small>via Trust Bundle
            Servers</small></h1>

            <p>BlueButton+ Pull uses <strong>Trust Bundle
            Servers</strong> to enable discovery of BB+ Providers
            and BB+ Apps. Each Trust Bundle Server exposes a set of
            trusted providers and a set of trusted apps at
            well-known <code>https</code> URLs, using simple
            <a href="http://json-ld.org/">JSON-LD</a> arrays. In
            the BB+ ecosystem, apps and providers must be
            pre-configured with a Trust Bundle Server (or
            Servers).</p>

            <h5>Why JSON-LD?</h5>

            <div class="well alert-info">
              <p><strong>JSON-LD</strong> provides a nice balance
              between idiomatic JSON and well-structured data
              representations. By combining a JSON payload with a
              JSON-LD context, properties can be expanded to full
              URIs so that data can be mixed and matched with other
              services. For example, the BB+ Provider element below
              can automatically be:</p>

              <ul>
                <li>
                  <a href="http://tinyurl.com/bpz5xsx" target=
                  "_blank">Expanded to full property URIs</a>
                </li>

                <li>
                  <a href="http://tinyurl.com/cp9vmum" target=
                  "_blank">Normalized in RDF</a>
                </li>
              </ul>
            </div>

            <h2 id="discovery-providers">Provider Discovery</h2>

            <p>A Trust Bundle Server exposes a BB+ Provider
            Discovery endpoint at:
            <code>/.well-known/providers.json</code></p>

            <h3>providers.json</h3>

            <p><code>providers.json</code> is a JSON array of
            Provider elements, expressed as JSON-LD with a default
            <code>@vocab</code> from <a href=
            "http://schema.org">http://schema.org</a> and
            additional properties defined in the <a href=
            "context-json-ld.js">BB+ JSON-LD Context</a></p>

            <p>While any vocabulary from schema.org may be used in
            describing a provider, the <strong>following fields are
            required:</strong></p>

            <table class="table table-striped">
              <tr>
                <th>Property</th>

                <th>Description</th>
              </tr>

              <tr>
                <td><code>name</code></td>

                <td>Name of the BB+ Data Provider organization</td>
              </tr>

              <tr>
                <td><code>url</code></td>

                <td>Primary url of the provider organization</td>
              </tr>

              <tr>
                <td><code>patient_signin</code></td>

                <td>URL where a patient can sign in to the
                Provider</td>
              </tr>

              <tr>
                <td><code>oauth2</code></td>

                <td>Collection of OAuth2 endpoints</td>
              </tr>

              <tr>
                <td class="subproperty"><code>authorize</code></td>

                <td>OAuth2 authorization endpoint</td>
              </tr>

              <tr>
                <td class="subproperty"><code>token</code></td>

                <td>OAuth2 token endpoint</td>
              </tr>

              <tr>
                <td><code>bb_api</code></td>

                <td>Collection of BB+ API endpoints</td>
              </tr>

              <tr>
                <td class="subproperty"><code>summary</code></td>

                <td>BlueButton+ Clinical Summary endpoint</td>
              </tr>

              <tr>
                <td class="subproperty"><code>search</code></td>

                <td>BlueButton+ Document Search endpoint</td>
              </tr>
            </table>

            <h5>providers.json example</h5>
            <pre class="prettify">
Content-Type: application/json
Link: &lt;http://jmandel.github.com/blue-button-plus-pull/context-json-ld.js&gt;; rel="http://www.w3.org/ns/json-ld#context"; type="application/ld+json"

[
{
  "name": "Good Health Clinic",
  "description": "Serving your health needs since 1999",
  "url": "http://goodhealthclinic.org",
  "patient_signin": "http://portal.goodhealthclinic.org",
  "location": {
    "geo": {                       
      "latitude": 42.3591,            # just making the point that we can
      "longitude": -71.0934           # use arbitrary schema.org properties
    }
  },
  "oauth2": {
    "authorize_uri": "http://portal.goodhealthclinic.org/authorize",
    "token_uri": "http://portal.goodhealthclinic.org/token"
  },
  "bb_api": {
    "summary": "http://api.goodhealthclinic.org/patient/documents/summary",
    "search": "http://api.goodhealthclinic.org/patient/documents/search"
  }
},
{
 ... (more providers here) ...
}
] 
</pre>

            <h2 id="discovery-apps">App Discovery</h2>

            <p>A Trust Bundle Server exposes a <strong>BB+ App
            Discovery</strong> endpoint at:
            <code>/.well-known/apps.json</code></p>

            <h3>apps.json</h3>

            <p><code>apps.json</code> is a JSON array of App
            elements, expressed as JSON-LD with a default
            <code>@vocab</code> from <a href=
            "http://schema.org">http://schema.org</a> and
            additional properties defined in the <a href=
            "context-json-ld.js">BB+ JSON-LD Context</a></p>

            <p>While any vocabulary from schema.org may be used in
            describing a provider, the <strong>following fields are
            required:</strong></p>

            <div class="well alert-error">
              JM: I kind of want to require *all* registration
              parameters to be fixed. We certainly should avoid
              shenanigans like extracting a JWS from an iPad app
              and re-registering a new instance with
              https://attacker.com redirect_uris...
            </div>

            <table class="table table-striped">
              <tr>
                <th>Property</th>

                <th>Description</th>
              </tr>

              <tr>
                <td><code>name</code></td>

                <td>Name of the BB+ App</td>
              </tr>

              <tr>
                <td><code>url</code></td>

                <td>Primary url of the provider organization</td>
              </tr>

              <tr>
                <td><code>fixed_registration_parameters</code></td>

                <td>
                  JSON structure containing any <a href=
                  "#registration-parameters">registration
                  parameters</a> that are fixed across all
                  instances of this app. A Trusted Registration
                  request that fails to match identically on any
                  parameters included here will be rejected.
                </td>
              </tr>

              <tr>
                <td class="subproperty">
                <code>client_name</code></td>

                <td>client_name must be fixed across all app
                instances and must match the schema.org name
                above</td>
              </tr>

              <tr>
                <td class="subproperty">
                <code>client_uri</code></td>

                <td>client_uri must be fixed across all app
                instances and must match the schema.org url
                above</td>
              </tr>

              <tr>
                <td class="subproperty">
                <code>redirect_uris</code></td>

                <td>the set of allowable redirect_uris must be
                fixed across all app instances</td>
              </tr>
            </table>

            <h5>apps.json example</h5>
            <pre class="prettify">
Content-Type: application/json
Link: &lt;http://jmandel.github.com/blue-button-plus-pull/context-json-ld.js&gt;; rel="http://www.w3.org/ns/json-ld#context"; type="application/ld+json"

[
{
  "url": "https://bpgrapher.org",
  "name": "Blood Pressure Grapher",
  "fixed_registration_parameters": {
      "client_name": "Blood Pressure Grapher",
      "client_uri": "https://bpgrapher.org",
      "logo_uri": "http://bpgrapher.org/images/logo.png",
      "contacts": [
        "plot-master@bpgrapher.org"
      ],
      "tos_uri": "https://bpgrapher.org/tos",
      "redirect_uris": [
        "https://bpgrapher.org/after-auth"
      ],
      "response_types": ["token"],
      "grant_types": ["implicit"],
      "token_endpoint_auth_method": "none",
      "scope":  "single-patient http://siframework.org/ABBI/endpoint/summary"
  },
},
{
 ... (more apps here) ...
}
] 
</pre>
          </div>
        </section>
      </div>
    </div>
  </div><!-- Footer
        ================================================== -->

  <footer class="footer">
    <div class="container">
      <p>Automate Blue Button Initiative 2013</p>
    </div>
  </footer><!-- Le javascript
        ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="./assets/js/jquery.js">
</script> <script src="./assets/js/bootstrap-transition.js">
</script> <script src="./assets/js/bootstrap-alert.js">
</script> <script src="./assets/js/bootstrap-modal.js">
</script> <script src="./assets/js/bootstrap-dropdown.js">
</script> <script src="./assets/js/bootstrap-tab.js">
</script> <script src="./assets/js/bootstrap-tooltip.js">
</script> <script src="./assets/js/bootstrap-popover.js">
</script> <script src="./assets/js/bootstrap-button.js">
</script> <script src="./assets/js/bootstrap-collapse.js">
</script> <script src="./assets/js/bootstrap-affix.js">
</script> <script src="./assets/js/bootstrap-scrollspy.js">
</script> <script src="./assets/js/bootstrap-carousel.js">
</script> <script src="./assets/js/bootstrap-typeahead.js">
</script> <script src="./assets/js/holder.js">
</script> <script src="./assets/js/prettify.js">
</script> <script src="./assets/js/application.js">
</script>
</body>
</html>
